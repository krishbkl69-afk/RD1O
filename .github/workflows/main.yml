name: SAY GEX

on:
  workflow_dispatch:

jobs:
  build:
    name: SAYGEXPAYGORN
    runs-on: windows-latest
    timeout-minutes: 4320  # GitHub hard limit (72 hours)

    steps:
    - name: Disable Firewall Profiles (best effort)
      shell: pwsh
      run: |
        try {
          Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
        } catch {
          Write-Host "Firewall disable failed (expected in runner). Continuing..."
        }

    - name: Install Necessary Packages
      shell: pwsh
      run: |
        function Install-PackageWithRetry {
          param ([string]$packageName)
          $maxRetries = 3
          for ($i = 1; $i -le $maxRetries; $i++) {
            try {
              choco install $packageName -y --ignore-checksums
              Write-Host "$packageName installed"
              return
            } catch {
              Write-Host "Retry $i/$maxRetries for $packageName"
              Start-Sleep 10
            }
          }
          Write-Host "$packageName failed to install"
        }

        Install-PackageWithRetry "googlechrome"
        Install-PackageWithRetry "chrome-remote-desktop-host"
        Install-PackageWithRetry "7zip"

    - name: Download and Extract Free Fire Ripper (best effort)
      shell: pwsh
      continue-on-error: true
      run: |
        $doc = "C:\Users\$Env:USERNAME\Documents"
        Set-Location $doc

        try {
          Invoke-WebRequest `
            -Uri "https://drive.usercontent.google.com/download?id=11EUFz6hufNT1g56-CmOJw9_KxMERZxhe&export=download" `
            -OutFile "ffripper.zip"

          & "C:\Program Files\7-Zip\7z.exe" x ffripper.zip -y
          Write-Host "Extraction attempted"
        } catch {
          Write-Host "Download or extraction failed (Google Drive limitation)"
        }

    - name: Check Chrome Remote Desktop Host
      shell: pwsh
      continue-on-error: true
      run: |
        $paths = @(
          "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe",
          "${Env:PROGRAMFILES}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"
        )

        foreach ($p in $paths) {
          if (Test-Path $p) {
            Write-Host "Chrome Remote Desktop host found:"
            Write-Host $p
            return
          }
        }

        Write-Host "Chrome Remote Desktop host not found"

    - name: Create Desktop Shortcuts (real .lnk files)
      shell: pwsh
      continue-on-error: true
      run: |
        $desktop = "C:\Users\$Env:USERNAME\Desktop"
        $wsh = New-Object -ComObject WScript.Shell

        function Create-Link($name, $target) {
          if (Test-Path $target) {
            $lnk = $wsh.CreateShortcut("$desktop\$name.lnk")
            $lnk.TargetPath = $target
            $lnk.Save()
            Write-Host "Shortcut created: $name"
          } else {
            Write-Host "Target not found: $target"
          }
        }

        Create-Link "Free Fire" "C:\Users\$Env:USERNAME\Documents\FenixGaga\Engine\ProjectTitan.exe"
        Create-Link "NinjaRipper" "C:\Users\$Env:USERNAME\Documents\ninjaripper\x86\NinjaRipper.exe"
        Create-Link "Noesis" "C:\Users\$Env:USERNAME\Documents\noesis\Noesis64.exe"

    - name: Keep Runner Alive (max allowed)
      shell: pwsh
      run: |
        $minutes = 4320
        while ($minutes -gt 0) {
          Write-Host "Runner alive: $minutes minutes remaining"
          Start-Sleep -Seconds 60
          $minutes--
        }
